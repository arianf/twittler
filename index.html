<!DOCTYPE html>
<html>
  <head>
    <title>Twittler</title>

    <script src="js/jquery.js"></script>
    <script src="js/data_generator.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="css/bootstrap.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="css/bootstrap-theme.css">

    <!-- Switch -->
    <link rel="stylesheet" href="css/bootstrap-switch.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Switch -->
    <script src="js/bootstrap-switch.js"></script>

  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container-fluid">
        
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapsible">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Twittler</a>
        </div>
        
        <div class="navbar-collapse collapse" id="navbar-collapsible">
          
          <div class="navbar-form navbar-right btn-group">
            <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-cog"></span></button>
            <button type="button" class="btn btn-default">Logout</button>
          </div>
          <form class="navbar-form">
            <div class="form-group" style="display:inline;">
              <div class="input-group">
                <span class="input-group-addon" id="basic-addon1">@</span><input type="text" class="form-control" id="search">
                <span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span>
              </div>
            </div>
          </form>
          
        </div>
        
      </div>
    </nav>

    <div class="container">
        <br>
        <div class="page-header">
          <h1 id="titleofpage">Twittler Feed</h1>

          <div class="text-right">
            <h2 class="h4">Auto-Reload</h2>
            <input type="checkbox" name="autoswitch" id="autoswitch" data-state="true" checked>
          </div>
        </div>
        <form>
          <div class="form-group">
            <input type="text" class="form-control" id="tweet" placeholder="Tweet something here" />
          </div>
        </form>
        <div class="list-group">
        </div>
    </div> <!-- /container -->
    
    <script>

      $(document).ready(function(){
        var $body = $('.list-group');
        // $body.html('');
        $("#autoswitch").bootstrapSwitch();

        $("#autoswitch").on('switchChange.bootstrapSwitch', function(event, state) {
          $(this).data('state', state);
        });

        $(".list-group").on('click', '.list-group-item', function(){
          $("#search").trigger('input').val(($(this).find('.username').text()).substr(1));
          searchUser();
        });

        $(".input-group").on('input', '#search', function(){
          searchUser();
        });

        var searchUser = function(){
          $(".list-group-item").css("display", "");
          $("#titleofpage").text("Twittler Feed");
          var searchBarVal = $('#search').val();
          if(searchBarVal != ''){
            $("#titleofpage").text(searchBarVal + "'s Timeline: ");
            $(".username").filter(function(item, element){
              return ($(this).text() != '@'+ searchBarVal);
            }).closest(".list-group-item").css("display", "none");
          }
        };

        var emptySteam = function() {
          var index = streams.home.length - 1;

          while(index >= 0 && $("#autoswitch").data('state')){
            var tweet = streams.home[index];
            var $tweet = $('<a href="#" class="list-group-item"><h4 class="list-group-item-heading"><span class="username"></span>&nbsp;&nbsp;<small class="date"></small></h4><p class="list-group-item-text"></p></a>');
            $tweet.find(".username").text('@' + tweet.user);
            $tweet.find(".date").text(tweet.created_at);
            $tweet.find(".list-group-item-text").text(tweet.message);
            

            var searchBarVal = $('#search').val();
            if(searchBarVal == '' || searchBarVal === tweet.user){
              $tweet.prependTo($body).hide().slideDown();
            }else{
              $tweet.prependTo($body).css("display", 'none');
            }
            index -= 1;
            // while($(".list-group-item:visible").length > 9){
            //   $(".list-group-item").last().slideDown().remove();
            // }
            streams.home.pop();
          }
          setTimeout(emptySteam, 1000);
        }
        emptySteam();
        
      });

    </script>

  </body>
</html>
